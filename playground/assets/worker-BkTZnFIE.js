var A=Object.defineProperty;var F=(f,p,h)=>p in f?A(f,p,{enumerable:!0,configurable:!0,writable:!0,value:h}):f[p]=h;var v=(f,p,h)=>F(f,typeof p!="symbol"?p+"":p,h);(function(){"use strict";function f(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var p,h;function w(){if(h)return p;h=1;function s(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function e(t){function r(o,a,l,g){function u(d){typeof self.postMessage!="function"?o.ports[0].postMessage(d):self.postMessage(d)}l?(typeof console<"u"&&"error"in console&&console.error("Worker caught an error:",l),u([a,{message:l.message}])):u([a,null,g])}function i(o,a){try{return{res:o(a)}}catch(l){return{err:l}}}function n(o,a,l,g){var u=i(a,g);u.err?r(o,l,u.err):s(u.res)?u.res.then(function(d){r(o,l,null,d)},function(d){r(o,l,d)}):r(o,l,null,u.res)}function c(o){var a=o.data;if(!(!Array.isArray(a)||a.length!==2)){var l=a[0],g=a[1];typeof t!="function"?r(o,l,new Error("Please pass a function into register().")):n(o,t,l,g)}}self.addEventListener("message",c)}return p=e,p}var S=w(),L=f(S),R=(s=>(s.CONTAINER="container",s.PAGE="page",s.ROOT="app",s))(R||{});class m{calculateRelativePosition(e,t){return t?{top:t.relativeY,left:t.relativeX}:{top:e.top,left:e.left}}createBaseStyle(e,t){const{top:r,left:i}=this.calculateRelativePosition(e,t);return{position:"absolute",width:+e.width,height:+e.height,top:+r,left:+i,right:void 0,bottom:void 0,backgroundImage:"",backgroundColor:"transparent",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%",backgroundPosition:"",color:"",fontSize:"",fontWeight:"",lineHeight:"",textAlign:"",display:"",flexDirection:"",justifyContent:"",alignItems:"",flexWrap:"",marginTop:"",marginRight:"",marginBottom:"",marginLeft:"",paddingTop:"",paddingRight:"",paddingBottom:"",paddingLeft:"",opacity:1,overflow:"initial",zIndex:"",transform:{rotate:"",scale:""},borderTopLeftRadius:"",borderTopRightRadius:"",borderBottomRightRadius:"",borderBottomLeftRadius:"",borderTopWidth:"",borderTopStyle:"",borderTopColor:"",borderRightWidth:"",borderRightStyle:"",borderRightColor:"",borderBottomWidth:"",borderBottomStyle:"",borderBottomColor:"",borderLeftWidth:"",borderLeftStyle:"",borderLeftColor:"",borderWidth:"",borderStyle:"",borderColor:""}}parseFills(e,t){return t.length&&t.forEach(r=>{var i;if(r.type==="gradient"){const n=r.gradient;if(n.type===0){const c=n.stops.map(g=>{const u=g.color.value,d=g.position*100;return`${u} ${d}%`}).join(", "),o=n.from,a=n.to,l=W(o,a);e.backgroundImage=`linear-gradient(${l}deg, ${c})`}}else r.type==="color"&&(e.backgroundColor=(i=r==null?void 0:r.color)==null?void 0:i.value)}),e}parseStyle(e,t){var i,n,c;const r=this.createBaseStyle(e.frame,t);if((i=e.style)!=null&&i.fills&&this.parseFills(r,e.style.fills),e.opacity&&(r.opacity=e.opacity),(c=(n=e.paths)==null?void 0:n[0])!=null&&c.radius){const o=e.paths[0].radius;r.borderTopLeftRadius=o.topLeft,r.borderTopRightRadius=o.topRight,r.borderBottomRightRadius=o.bottomRight,r.borderBottomLeftRadius=o.bottomLeft}return r}}class x extends m{visit(e,t){return{type:"page",id:`page_${e.id}`,name:e.name,title:"",layout:"absolute",style:{...this.parseStyle(e,t),top:0,left:0},items:e.layers??[]}}}class P extends m{visit(e,t){return{id:`component_${e.id}`,type:"container",name:e.name,layout:"absolute",style:this.parseStyle(e,t),events:[],created:"",items:e.layers??[]}}}class C extends m{visit(e,t){return{id:`component_${e.id}`,type:"container",name:e.name,layout:"absolute",style:this.parseStyle(e,t),events:[],created:"",items:[]}}}class E extends m{visit(e,t){return{id:`component_${e.id}`,type:"container",name:e.name,layout:"absolute",style:this.parseStyle(e,t),events:[],created:"",items:e.layers??[]}}}class N extends m{visit(e,t){var r,i,n,c,o,a,l,g,u;return{id:`component_${e.id}`,type:"text",name:e.name,text:(r=e.text)==null?void 0:r.value,style:{...this.parseStyle(e,t),backgroundColor:"",color:(o=(c=(n=(i=e.style)==null?void 0:i.fills)==null?void 0:n[0])==null?void 0:c.color)==null?void 0:o.value,fontSize:(a=e.text)==null?void 0:a.style.font.size,fontWeight:(l=e.text)==null?void 0:l.style.font.fontWeight,lineHeight:B((g=e.text)==null?void 0:g.style.font.lineHeight,(u=e.text)==null?void 0:u.style.font.size)},events:[],created:""}}}const y=class y{constructor(){v(this,"visitors");this.visitors=new Map,this.registerDefaultVisitors()}static getInstance(){return y.instance||(y.instance=new y),y.instance}registerDefaultVisitors(){this.visitors.set("page",new x),this.visitors.set("artboard",new P),this.visitors.set("shapeLayer",new C),this.visitors.set("groupLayer",new E),this.visitors.set("textLayer",new N)}parse(e,t,r){const i=this.visitors.get(t??e.type);if(!i)throw new Error(`Unsupported node type: ${t??e.type}`);try{return i.visit(e,r)}catch(n){throw new Error(`Parse error: ${n.message}`)}}};v(y,"instance");let b=y;class T{constructor(){v(this,"nodeParser");this.nodeParser=b.getInstance()}parse(e){try{this.validateFigmaJson(e);const{artboard:t,meta:r}=e;return{type:R.ROOT,name:r.device,id:r.id,items:[this.parsePage(t)]}}catch(t){throw new Error(`Figma parse error: ${t.message}`)}}validateFigmaJson(e){if(!e)throw new Error("Figma JSON is empty");if(!e.artboard)throw new Error("Figma JSON must have an artboard node");if(!e.meta)throw new Error("Figma JSON must have a meta node")}parsePage(e){const t={relativeX:0,relativeY:0},r=this.nodeParser.parse(e,"page");return r.items=Array.isArray(r.items)?r.items.map(i=>this.parseNode(i,[t])):[],r}parseNode(e,t){var n,c;const r={relativeX:(((n=e.frame)==null?void 0:n.left)||0)-t.reduce((o,a)=>o+a.relativeX,0),relativeY:(((c=e.frame)==null?void 0:c.top)||0)-t.reduce((o,a)=>o+a.relativeY,0)},i=this.nodeParser.parse(e,e.type,r);return Array.isArray(i.items)&&(i.items=i.items.map(o=>this.parseNode(o,t.concat(r)))),i}}function B(s,e){return typeof s=="object"&&s?(s==null?void 0:s.unit.toUpperCase())==="PERCENT"?s.value*e/100:(s==null?void 0:s.unit.toUpperCase())==="AUTO"?1.171875*e:s==null?void 0:s.value:s}function W(s,e){const t=s,r=e,i=r.x-t.x,n=r.y-t.y;let c=180*Math.atan2(n,i)/Math.PI+90;return c<0&&(c+=360),c}const $=new T;L(s=>{if(s.type==="parse"){const e=typeof s.message=="string"?JSON.parse(s.message):s.message;try{const t=$.parse(e);return Promise.resolve({code:200,message:"success",data:t})}catch(t){return Promise.reject(t)}}})})();
